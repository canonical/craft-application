summary: test advanced grammar

environment:
  PROJECT/onto: onto
  PROJECT/for: for

execute: |
  cd $PROJECT

  testcraft pack --platform platform1

  mkdir output
  tar --extract --file grammar-1.0-platform1.testcraft --directory output

  # verify grammar was processed
  if ! grep "I was built for platform1" "output/hello-world.txt"; then
    echo "Grammar was not processed as expected!"
    exit 1
  fi

restore: |
  cd $PROJECT

  rm -f *.testcraft
  rm -rf output
